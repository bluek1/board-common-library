@page "/page4"
@model BoardTestWeb.Pages.Page4.IndexModel
@{
    ViewData["Title"] = "í˜ì´ì§€ 4: ê´€ë¦¬ì/Q&A í…ŒìŠ¤íŠ¸";
}

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"]</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-warning">
        <div class="container">
            <a class="navbar-brand text-dark" href="/">ğŸ“‹ ê²Œì‹œíŒ ë¼ì´ë¸ŒëŸ¬ë¦¬ í…ŒìŠ¤íŠ¸</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link text-dark" href="/">ëŒ€ì‹œë³´ë“œ</a>
                <a class="nav-link text-dark" href="/page1">í˜ì´ì§€ 1</a>
                <a class="nav-link text-dark" href="/page2">í˜ì´ì§€ 2</a>
                <a class="nav-link text-dark" href="/page3">í˜ì´ì§€ 3</a>
                <a class="nav-link active text-dark fw-bold" href="/page4">í˜ì´ì§€ 4</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <h1>âš™ï¸ í˜ì´ì§€ 4: ê´€ë¦¬ì/Q&A í…ŒìŠ¤íŠ¸</h1>
        <p class="lead">ê´€ë¦¬ì ê¸°ëŠ¥ê³¼ Q&A ê²Œì‹œíŒ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>

        <div class="row">
            <!-- í…ŒìŠ¤íŠ¸ ì‹¤í–‰ íŒ¨ë„ -->
            <div class="col-md-4">
                <div class="card mb-4">
                    <div class="card-header bg-warning">
                        <h5 class="mb-0">í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-warning w-100 mb-3" onclick="runPageTests()">
                            â–¶ ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
                        </button>
                        <div id="testCases">
                            <!-- í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ëª©ë¡ -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- API í…ŒìŠ¤íŠ¸ íŒ¨ë„ -->
            <div class="col-md-8">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">API í…ŒìŠ¤íŠ¸</h5>
                    </div>
                    <div class="card-body">
                        <ul class="nav nav-tabs" id="apiTabs" role="tablist">
                            <li class="nav-item">
                                <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#admin">ê´€ë¦¬ì</button>
                            </li>
                            <li class="nav-item">
                                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#reports">ì‹ ê³  ê´€ë¦¬</button>
                            </li>
                            <li class="nav-item">
                                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#questions">Q&A ì§ˆë¬¸</button>
                            </li>
                            <li class="nav-item">
                                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#answers">Q&A ë‹µë³€</button>
                            </li>
                        </ul>
                        <div class="tab-content p-3 border border-top-0">
                            <!-- ê´€ë¦¬ì -->
                            <div class="tab-pane fade show active" id="admin">
                                <h6>ê´€ë¦¬ì ê¸°ëŠ¥</h6>
                                <div class="row mb-3">
                                    <div class="col">
                                        <button class="btn btn-primary me-2" onclick="getAdminPosts()">ê²Œì‹œë¬¼ ê´€ë¦¬</button>
                                        <button class="btn btn-secondary me-2" onclick="getAdminComments()">ëŒ“ê¸€ ê´€ë¦¬</button>
                                        <button class="btn btn-info" onclick="getStatistics()">í†µê³„</button>
                                    </div>
                                </div>
                                <hr>
                                <h6>ì¼ê´„ ì‚­ì œ</h6>
                                <div class="mb-3">
                                    <label class="form-label">ì‚­ì œí•  ID ëª©ë¡ (ì‰¼í‘œ êµ¬ë¶„)</label>
                                    <input type="text" class="form-control" id="batchDeleteIds" placeholder="1,2,3">
                                </div>
                                <select class="form-select mb-3" id="batchDeleteType">
                                    <option value="Post">ê²Œì‹œë¬¼</option>
                                    <option value="Comment">ëŒ“ê¸€</option>
                                </select>
                                <button class="btn btn-danger" onclick="batchDelete()">ì¼ê´„ ì‚­ì œ</button>
                            </div>

                            <!-- ì‹ ê³  ê´€ë¦¬ -->
                            <div class="tab-pane fade" id="reports">
                                <h6>ì‹ ê³  ê´€ë¦¬</h6>
                                <button class="btn btn-primary mb-3" onclick="getReports()">ì‹ ê³  ëª©ë¡ ì¡°íšŒ</button>
                                <hr>
                                <div class="mb-3">
                                    <label class="form-label">ì‹ ê³  ID</label>
                                    <input type="number" class="form-control" id="reportId" value="1">
                                </div>
                                <button class="btn btn-success me-2" onclick="approveReport()">ìŠ¹ì¸</button>
                                <button class="btn btn-secondary" onclick="rejectReport()">ê±°ë¶€</button>
                                <hr>
                                <h6>ë¸”ë¼ì¸ë“œ</h6>
                                <div class="row mb-3">
                                    <div class="col">
                                        <select class="form-select" id="blindType">
                                            <option value="Post">ê²Œì‹œë¬¼</option>
                                            <option value="Comment">ëŒ“ê¸€</option>
                                        </select>
                                    </div>
                                    <div class="col">
                                        <input type="number" class="form-control" id="blindTargetId" placeholder="ëŒ€ìƒ ID">
                                    </div>
                                </div>
                                <button class="btn btn-dark" onclick="blindContent()">ë¸”ë¼ì¸ë“œ</button>
                            </div>

                            <!-- Q&A ì§ˆë¬¸ -->
                            <div class="tab-pane fade" id="questions">
                                <h6>ì§ˆë¬¸ ê´€ë¦¬</h6>
                                <button class="btn btn-primary mb-3" onclick="getQuestions()">ì§ˆë¬¸ ëª©ë¡</button>
                                <hr>
                                <h6>ì§ˆë¬¸ ì‘ì„±</h6>
                                <div class="mb-3">
                                    <label class="form-label">ì œëª©</label>
                                    <input type="text" class="form-control" id="questionTitle" placeholder="ì§ˆë¬¸ ì œëª©">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">ë‚´ìš©</label>
                                    <textarea class="form-control" id="questionContent" rows="3" placeholder="ì§ˆë¬¸ ë‚´ìš©"></textarea>
                                </div>
                                <button class="btn btn-success" onclick="createQuestion()">ì§ˆë¬¸ ì‘ì„±</button>
                                <hr>
                                <h6>ì§ˆë¬¸ ì¡°íšŒ</h6>
                                <div class="mb-3">
                                    <input type="number" class="form-control" id="viewQuestionId" value="1" placeholder="ì§ˆë¬¸ ID">
                                </div>
                                <button class="btn btn-primary" onclick="viewQuestion()">ì¡°íšŒ</button>
                            </div>

                            <!-- Q&A ë‹µë³€ -->
                            <div class="tab-pane fade" id="answers">
                                <h6>ë‹µë³€ ê´€ë¦¬</h6>
                                <div class="mb-3">
                                    <label class="form-label">ì§ˆë¬¸ ID</label>
                                    <input type="number" class="form-control" id="answerQuestionId" value="1">
                                </div>
                                <button class="btn btn-primary mb-3" onclick="getAnswers()">ë‹µë³€ ëª©ë¡</button>
                                <hr>
                                <h6>ë‹µë³€ ì‘ì„±</h6>
                                <div class="mb-3">
                                    <textarea class="form-control" id="answerContent" rows="3" placeholder="ë‹µë³€ ë‚´ìš©"></textarea>
                                </div>
                                <button class="btn btn-success" onclick="createAnswer()">ë‹µë³€ ì‘ì„±</button>
                                <hr>
                                <h6>ë‹µë³€ ì±„íƒ/ì¶”ì²œ</h6>
                                <div class="mb-3">
                                    <label class="form-label">ë‹µë³€ ID</label>
                                    <input type="number" class="form-control" id="answerActionId" value="1">
                                </div>
                                <button class="btn btn-warning me-2" onclick="acceptAnswer()">ì±„íƒ</button>
                                <button class="btn btn-success me-2" onclick="voteAnswerUp()">ğŸ‘ ì¶”ì²œ</button>
                                <button class="btn btn-danger" onclick="voteAnswerDown()">ğŸ‘ ë¹„ì¶”ì²œ</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ê²°ê³¼ í‘œì‹œ -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">ê²°ê³¼</h5>
                    </div>
                    <div class="card-body">
                        <pre id="apiResult" class="bg-light p-3" style="max-height: 400px; overflow-y: auto;">ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_BASE = '/api/page4';

        function showResult(data) {
            document.getElementById('apiResult').textContent = JSON.stringify(data, null, 2);
        }

        // ê´€ë¦¬ì ê¸°ëŠ¥
        async function getAdminPosts() {
            const response = await fetch(`${API_BASE}/admin/posts`);
            const data = await response.json();
            showResult(data);
        }

        async function getAdminComments() {
            const response = await fetch(`${API_BASE}/admin/comments`);
            const data = await response.json();
            showResult(data);
        }

        async function getStatistics() {
            const response = await fetch(`${API_BASE}/admin/statistics`);
            const data = await response.json();
            showResult(data);
        }

        async function batchDelete() {
            const idsText = document.getElementById('batchDeleteIds').value;
            const targetType = document.getElementById('batchDeleteType').value;
            const ids = idsText.split(',').map(id => parseInt(id.trim())).filter(id => !isNaN(id));

            const response = await fetch(`${API_BASE}/admin/batch/delete`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ targetType, ids })
            });
            const data = await response.json();
            showResult(data);
        }

        // ì‹ ê³  ê´€ë¦¬
        async function getReports() {
            const response = await fetch(`${API_BASE}/admin/reports`);
            const data = await response.json();
            showResult(data);
        }

        async function approveReport() {
            const id = document.getElementById('reportId').value;
            const response = await fetch(`${API_BASE}/admin/reports/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: 'approve' })
            });
            const data = await response.json();
            showResult(data);
        }

        async function rejectReport() {
            const id = document.getElementById('reportId').value;
            const response = await fetch(`${API_BASE}/admin/reports/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: 'reject' })
            });
            const data = await response.json();
            showResult(data);
        }

        async function blindContent() {
            const targetType = document.getElementById('blindType').value;
            const targetId = document.getElementById('blindTargetId').value;

            const response = await fetch(`${API_BASE}/admin/blind`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ targetType, targetId: parseInt(targetId) })
            });
            const data = await response.json();
            showResult(data);
        }

        // Q&A ì§ˆë¬¸
        async function getQuestions() {
            const response = await fetch(`${API_BASE}/questions`);
            const data = await response.json();
            showResult(data);
        }

        async function createQuestion() {
            const title = document.getElementById('questionTitle').value;
            const content = document.getElementById('questionContent').value;

            const response = await fetch(`${API_BASE}/questions`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ title, content })
            });
            const data = await response.json();
            showResult(data);
        }

        async function viewQuestion() {
            const id = document.getElementById('viewQuestionId').value;
            const response = await fetch(`${API_BASE}/questions/${id}`);
            const data = await response.json();
            showResult(data);
        }

        // Q&A ë‹µë³€
        async function getAnswers() {
            const questionId = document.getElementById('answerQuestionId').value;
            const response = await fetch(`${API_BASE}/questions/${questionId}/answers`);
            const data = await response.json();
            showResult(data);
        }

        async function createAnswer() {
            const questionId = document.getElementById('answerQuestionId').value;
            const content = document.getElementById('answerContent').value;

            const response = await fetch(`${API_BASE}/questions/${questionId}/answers`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ content })
            });
            const data = await response.json();
            showResult(data);
        }

        async function acceptAnswer() {
            const id = document.getElementById('answerActionId').value;
            const response = await fetch(`${API_BASE}/answers/${id}/accept`, { method: 'POST' });
            const data = await response.json();
            showResult(data);
        }

        async function voteAnswerUp() {
            const id = document.getElementById('answerActionId').value;
            const response = await fetch(`${API_BASE}/answers/${id}/vote`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ voteType: 'up' })
            });
            const data = await response.json();
            showResult(data);
        }

        async function voteAnswerDown() {
            const id = document.getElementById('answerActionId').value;
            const response = await fetch(`${API_BASE}/answers/${id}/vote`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ voteType: 'down' })
            });
            const data = await response.json();
            showResult(data);
        }

        async function runPageTests() {
            const response = await fetch('/api/test/run/4', { method: 'POST' });
            const data = await response.json();
            showResult(data);
            loadTestCases();
        }

        async function loadTestCases() {
            const response = await fetch('/api/test/cases?pageNumber=4');
            const cases = await response.json();
            
            const statusResponse = await fetch('/api/test/page/4');
            const status = await statusResponse.json();
            
            const html = cases.map(tc => {
                const result = status.testResults.find(r => r.testId === tc.testId);
                const statusClass = result ? (result.passed ? 'text-success' : 'text-danger') : 'text-secondary';
                const statusIcon = result ? (result.passed ? 'âœ…' : 'âŒ') : 'â³';
                return `<div class="mb-2 ${statusClass}"><small>${statusIcon} ${tc.testId}: ${tc.testName}</small></div>`;
            }).join('');
            
            document.getElementById('testCases').innerHTML = html;
        }

        document.addEventListener('DOMContentLoaded', loadTestCases);
    </script>
</body>
</html>
