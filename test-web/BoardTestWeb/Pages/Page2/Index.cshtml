@page "/page2"
@model BoardTestWeb.Pages.Page2.IndexModel
@{
    ViewData["Title"] = "í˜ì´ì§€ 2: ëŒ“ê¸€/ì¢‹ì•„ìš” í…ŒìŠ¤íŠ¸";
}

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"]</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-success">
        <div class="container">
            <a class="navbar-brand" href="/">ğŸ“‹ ê²Œì‹œíŒ ë¼ì´ë¸ŒëŸ¬ë¦¬ í…ŒìŠ¤íŠ¸</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/">ëŒ€ì‹œë³´ë“œ</a>
                <a class="nav-link" href="/page1">í˜ì´ì§€ 1</a>
                <a class="nav-link active" href="/page2">í˜ì´ì§€ 2</a>
                <a class="nav-link" href="/page3">í˜ì´ì§€ 3</a>
                <a class="nav-link" href="/page4">í˜ì´ì§€ 4</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <h1>ğŸ’¬ í˜ì´ì§€ 2: ëŒ“ê¸€/ì¢‹ì•„ìš” í…ŒìŠ¤íŠ¸</h1>
        <p class="lead">ëŒ“ê¸€, ëŒ€ëŒ“ê¸€, ì¢‹ì•„ìš”, ë¶ë§ˆí¬ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>

        <div class="row">
            <!-- í…ŒìŠ¤íŠ¸ ì‹¤í–‰ íŒ¨ë„ -->
            <div class="col-md-4">
                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-success w-100 mb-3" onclick="runPageTests()">
                            â–¶ ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
                        </button>
                        <div id="testCases">
                            <!-- í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ëª©ë¡ -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- API í…ŒìŠ¤íŠ¸ íŒ¨ë„ -->
            <div class="col-md-8">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">API í…ŒìŠ¤íŠ¸</h5>
                    </div>
                    <div class="card-body">
                        <ul class="nav nav-tabs" id="apiTabs" role="tablist">
                            <li class="nav-item">
                                <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#comments">ëŒ“ê¸€</button>
                            </li>
                            <li class="nav-item">
                                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#replies">ëŒ€ëŒ“ê¸€</button>
                            </li>
                            <li class="nav-item">
                                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#likes">ì¢‹ì•„ìš”</button>
                            </li>
                            <li class="nav-item">
                                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#bookmarks">ë¶ë§ˆí¬</button>
                            </li>
                        </ul>
                        <div class="tab-content p-3 border border-top-0">
                            <!-- ëŒ“ê¸€ -->
                            <div class="tab-pane fade show active" id="comments">
                                <h6>ëŒ“ê¸€ ê´€ë¦¬</h6>
                                <div class="mb-3">
                                    <label class="form-label">ê²Œì‹œë¬¼ ID</label>
                                    <input type="number" class="form-control" id="commentPostId" value="1" min="1">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">ëŒ“ê¸€ ë‚´ìš©</label>
                                    <textarea class="form-control" id="commentContent" rows="2" placeholder="ëŒ“ê¸€ ë‚´ìš©"></textarea>
                                </div>
                                <button class="btn btn-success me-2" onclick="createComment()">ì‘ì„±</button>
                                <button class="btn btn-outline-success" onclick="getComments()">ëª©ë¡ë³´ê¸°</button>
                            </div>

                            <!-- ëŒ€ëŒ“ê¸€ -->
                            <div class="tab-pane fade" id="replies">
                                <h6>ëŒ€ëŒ“ê¸€</h6>
                                <div class="mb-3">
                                    <label class="form-label">ë¶€ëª¨ ëŒ“ê¸€ ID</label>
                                    <input type="number" class="form-control" id="parentCommentId" value="1" min="1">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">ëŒ€ëŒ“ê¸€ ë‚´ìš©</label>
                                    <textarea class="form-control" id="replyContent" rows="2" placeholder="ëŒ€ëŒ“ê¸€ ë‚´ìš©"></textarea>
                                </div>
                                <button class="btn btn-success" onclick="createReply()">ëŒ€ëŒ“ê¸€ ì‘ì„±</button>
                            </div>

                            <!-- ì¢‹ì•„ìš” -->
                            <div class="tab-pane fade" id="likes">
                                <h6>ì¢‹ì•„ìš”</h6>
                                <div class="row mb-3">
                                    <div class="col">
                                        <label class="form-label">ê²Œì‹œë¬¼ ID</label>
                                        <input type="number" class="form-control" id="likePostId" value="1" min="1">
                                    </div>
                                </div>
                                <button class="btn btn-danger me-2" onclick="likePost()">â¤ï¸ ì¢‹ì•„ìš”</button>
                                <button class="btn btn-outline-danger" onclick="unlikePost()">ğŸ’” ì·¨ì†Œ</button>
                                <hr>
                                <div class="row mb-3">
                                    <div class="col">
                                        <label class="form-label">ëŒ“ê¸€ ID</label>
                                        <input type="number" class="form-control" id="likeCommentId" value="1" min="1">
                                    </div>
                                </div>
                                <button class="btn btn-danger" onclick="likeComment()">â¤ï¸ ëŒ“ê¸€ ì¢‹ì•„ìš”</button>
                            </div>

                            <!-- ë¶ë§ˆí¬ -->
                            <div class="tab-pane fade" id="bookmarks">
                                <h6>ë¶ë§ˆí¬</h6>
                                <div class="mb-3">
                                    <label class="form-label">ê²Œì‹œë¬¼ ID</label>
                                    <input type="number" class="form-control" id="bookmarkPostId" value="1" min="1">
                                </div>
                                <button class="btn btn-warning me-2" onclick="bookmarkPost()">ğŸ”– ë¶ë§ˆí¬</button>
                                <button class="btn btn-outline-warning me-2" onclick="unbookmarkPost()">ë¶ë§ˆí¬ í•´ì œ</button>
                                <button class="btn btn-outline-primary" onclick="getBookmarks()">ë‚´ ë¶ë§ˆí¬</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ê²°ê³¼ í‘œì‹œ -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">ê²°ê³¼</h5>
                    </div>
                    <div class="card-body">
                        <pre id="apiResult" class="bg-light p-3" style="max-height: 400px; overflow-y: auto;">ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_BASE = '/api/page2';

        function showResult(data) {
            document.getElementById('apiResult').textContent = JSON.stringify(data, null, 2);
        }

        async function createComment() {
            const postId = document.getElementById('commentPostId').value;
            const content = document.getElementById('commentContent').value;
            
            const response = await fetch(`${API_BASE}/posts/${postId}/comments`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ content })
            });
            const data = await response.json();
            showResult(data);
        }

        async function getComments() {
            const postId = document.getElementById('commentPostId').value;
            
            const response = await fetch(`${API_BASE}/posts/${postId}/comments`);
            const data = await response.json();
            showResult(data);
        }

        async function createReply() {
            const parentId = document.getElementById('parentCommentId').value;
            const content = document.getElementById('replyContent').value;
            
            const response = await fetch(`${API_BASE}/comments/${parentId}/replies`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ content })
            });
            const data = await response.json();
            showResult(data);
        }

        async function likePost() {
            const postId = document.getElementById('likePostId').value;
            
            const response = await fetch(`${API_BASE}/posts/${postId}/like`, { method: 'POST' });
            const data = await response.json();
            showResult(data);
        }

        async function unlikePost() {
            const postId = document.getElementById('likePostId').value;
            
            const response = await fetch(`${API_BASE}/posts/${postId}/like`, { method: 'DELETE' });
            const data = await response.json();
            showResult(data);
        }

        async function likeComment() {
            const commentId = document.getElementById('likeCommentId').value;
            
            const response = await fetch(`${API_BASE}/comments/${commentId}/like`, { method: 'POST' });
            const data = await response.json();
            showResult(data);
        }

        async function bookmarkPost() {
            const postId = document.getElementById('bookmarkPostId').value;
            
            const response = await fetch(`${API_BASE}/posts/${postId}/bookmark`, { method: 'POST' });
            const data = await response.json();
            showResult(data);
        }

        async function unbookmarkPost() {
            const postId = document.getElementById('bookmarkPostId').value;
            
            const response = await fetch(`${API_BASE}/posts/${postId}/bookmark`, { method: 'DELETE' });
            const data = await response.json();
            showResult(data);
        }

        async function getBookmarks() {
            const response = await fetch(`${API_BASE}/users/me/bookmarks`);
            const data = await response.json();
            showResult(data);
        }

        async function runPageTests() {
            const response = await fetch('/api/test/run/2', { method: 'POST' });
            const data = await response.json();
            showResult(data);
            loadTestCases();
        }

        async function loadTestCases() {
            const response = await fetch('/api/test/cases?pageNumber=2');
            const cases = await response.json();
            
            const statusResponse = await fetch('/api/test/page/2');
            const status = await statusResponse.json();
            
            const html = cases.map(tc => {
                const result = status.testResults.find(r => r.testId === tc.testId);
                const statusClass = result ? (result.passed ? 'text-success' : 'text-danger') : 'text-secondary';
                const statusIcon = result ? (result.passed ? 'âœ…' : 'âŒ') : 'â³';
                return `<div class="mb-2 ${statusClass}"><small>${statusIcon} ${tc.testId}: ${tc.testName}</small></div>`;
            }).join('');
            
            document.getElementById('testCases').innerHTML = html;
        }

        document.addEventListener('DOMContentLoaded', loadTestCases);
    </script>
</body>
</html>
