@page "/page3"
@model BoardTestWeb.Pages.Page3.IndexModel
@{
    ViewData["Title"] = "í˜ì´ì§€ 3: íŒŒì¼/ê²€ìƒ‰ í…ŒìŠ¤íŠ¸";
}

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"]</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-info">
        <div class="container">
            <a class="navbar-brand" href="/">ğŸ“‹ ê²Œì‹œíŒ ë¼ì´ë¸ŒëŸ¬ë¦¬ í…ŒìŠ¤íŠ¸</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/">ëŒ€ì‹œë³´ë“œ</a>
                <a class="nav-link" href="/page1">í˜ì´ì§€ 1</a>
                <a class="nav-link" href="/page2">í˜ì´ì§€ 2</a>
                <a class="nav-link active" href="/page3">í˜ì´ì§€ 3</a>
                <a class="nav-link" href="/page4">í˜ì´ì§€ 4</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <h1>ğŸ“ í˜ì´ì§€ 3: íŒŒì¼/ê²€ìƒ‰ í…ŒìŠ¤íŠ¸</h1>
        <p class="lead">íŒŒì¼ ì—…ë¡œë“œ, ì¸ë„¤ì¼ ìƒì„±, ê²€ìƒ‰ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>

        <div class="row">
            <!-- í…ŒìŠ¤íŠ¸ ì‹¤í–‰ íŒ¨ë„ -->
            <div class="col-md-4">
                <div class="card mb-4">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-info w-100 mb-3" onclick="runPageTests()">
                            â–¶ ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
                        </button>
                        <div id="testCases">
                            <!-- í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ëª©ë¡ -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- API í…ŒìŠ¤íŠ¸ íŒ¨ë„ -->
            <div class="col-md-8">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">API í…ŒìŠ¤íŠ¸</h5>
                    </div>
                    <div class="card-body">
                        <ul class="nav nav-tabs" id="apiTabs" role="tablist">
                            <li class="nav-item">
                                <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#fileUpload">íŒŒì¼ ì—…ë¡œë“œ</button>
                            </li>
                            <li class="nav-item">
                                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#fileManage">íŒŒì¼ ê´€ë¦¬</button>
                            </li>
                            <li class="nav-item">
                                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#search">ê²€ìƒ‰</button>
                            </li>
                        </ul>
                        <div class="tab-content p-3 border border-top-0">
                            <!-- íŒŒì¼ ì—…ë¡œë“œ -->
                            <div class="tab-pane fade show active" id="fileUpload">
                                <h6>íŒŒì¼ ì—…ë¡œë“œ</h6>
                                <div class="mb-3">
                                    <label class="form-label">íŒŒì¼ ì„ íƒ</label>
                                    <input type="file" class="form-control" id="uploadFile">
                                    <small class="text-muted">í—ˆìš© í™•ì¥ì: .jpg, .jpeg, .png, .gif, .pdf, .doc, .docx (ìµœëŒ€ 10MB)</small>
                                </div>
                                <button class="btn btn-info" onclick="uploadFile()">ì—…ë¡œë“œ</button>
                                <hr>
                                <h6>ë‹¤ì¤‘ íŒŒì¼ ì—…ë¡œë“œ</h6>
                                <div class="mb-3">
                                    <input type="file" class="form-control" id="uploadFiles" multiple>
                                </div>
                                <button class="btn btn-info" onclick="uploadMultipleFiles()">ë‹¤ì¤‘ ì—…ë¡œë“œ</button>
                            </div>

                            <!-- íŒŒì¼ ê´€ë¦¬ -->
                            <div class="tab-pane fade" id="fileManage">
                                <h6>íŒŒì¼ ê´€ë¦¬</h6>
                                <div class="mb-3">
                                    <label class="form-label">íŒŒì¼ ID</label>
                                    <input type="text" class="form-control" id="fileId" placeholder="íŒŒì¼ GUID">
                                </div>
                                <button class="btn btn-primary me-2" onclick="downloadFile()">ë‹¤ìš´ë¡œë“œ</button>
                                <button class="btn btn-secondary me-2" onclick="getThumbnail()">ì¸ë„¤ì¼</button>
                                <button class="btn btn-danger" onclick="deleteFile()">ì‚­ì œ</button>
                            </div>

                            <!-- ê²€ìƒ‰ -->
                            <div class="tab-pane fade" id="search">
                                <h6>í†µí•© ê²€ìƒ‰</h6>
                                <div class="mb-3">
                                    <label class="form-label">ê²€ìƒ‰ì–´</label>
                                    <input type="text" class="form-control" id="searchQuery" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥">
                                </div>
                                <button class="btn btn-primary me-2" onclick="searchAll()">í†µí•© ê²€ìƒ‰</button>
                                <button class="btn btn-outline-primary" onclick="searchPosts()">ê²Œì‹œë¬¼ ê²€ìƒ‰</button>
                                <hr>
                                <h6>íƒœê·¸ ê²€ìƒ‰</h6>
                                <div class="mb-3">
                                    <input type="text" class="form-control" id="tagQuery" placeholder="íƒœê·¸ëª…">
                                </div>
                                <button class="btn btn-secondary" onclick="searchTags()">íƒœê·¸ ê²€ìƒ‰</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ê²°ê³¼ í‘œì‹œ -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">ê²°ê³¼</h5>
                    </div>
                    <div class="card-body">
                        <pre id="apiResult" class="bg-light p-3" style="max-height: 400px; overflow-y: auto;">ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_BASE = '/api/page3';

        function showResult(data) {
            document.getElementById('apiResult').textContent = JSON.stringify(data, null, 2);
        }

        async function uploadFile() {
            const fileInput = document.getElementById('uploadFile');
            if (!fileInput.files[0]) {
                showResult({ error: 'íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.' });
                return;
            }

            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            const response = await fetch(`${API_BASE}/files/upload`, {
                method: 'POST',
                body: formData
            });
            const data = await response.json();
            showResult(data);
        }

        async function uploadMultipleFiles() {
            const fileInput = document.getElementById('uploadFiles');
            if (!fileInput.files.length) {
                showResult({ error: 'íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.' });
                return;
            }

            const formData = new FormData();
            for (let file of fileInput.files) {
                formData.append('files', file);
            }

            const response = await fetch(`${API_BASE}/files/upload-multiple`, {
                method: 'POST',
                body: formData
            });
            const data = await response.json();
            showResult(data);
        }

        async function downloadFile() {
            const fileId = document.getElementById('fileId').value;
            if (!fileId) {
                showResult({ error: 'íŒŒì¼ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.' });
                return;
            }

            showResult({ message: `íŒŒì¼ ë‹¤ìš´ë¡œë“œ ìš”ì²­: ${API_BASE}/files/${fileId}` });
            window.open(`${API_BASE}/files/${fileId}`, '_blank');
        }

        async function getThumbnail() {
            const fileId = document.getElementById('fileId').value;
            if (!fileId) {
                showResult({ error: 'íŒŒì¼ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.' });
                return;
            }

            showResult({ message: `ì¸ë„¤ì¼ ì¡°íšŒ: ${API_BASE}/files/${fileId}/thumbnail` });
            window.open(`${API_BASE}/files/${fileId}/thumbnail`, '_blank');
        }

        async function deleteFile() {
            const fileId = document.getElementById('fileId').value;
            if (!fileId) {
                showResult({ error: 'íŒŒì¼ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.' });
                return;
            }

            const response = await fetch(`${API_BASE}/files/${fileId}`, { method: 'DELETE' });
            if (response.status === 204) {
                showResult({ success: true, message: 'íŒŒì¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.' });
            } else {
                const data = await response.json();
                showResult(data);
            }
        }

        async function searchAll() {
            const query = document.getElementById('searchQuery').value;
            if (!query) {
                showResult({ error: 'ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.' });
                return;
            }

            const response = await fetch(`${API_BASE}/search?q=${encodeURIComponent(query)}`);
            const data = await response.json();
            showResult(data);
        }

        async function searchPosts() {
            const query = document.getElementById('searchQuery').value;
            if (!query) {
                showResult({ error: 'ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.' });
                return;
            }

            const response = await fetch(`${API_BASE}/search/posts?q=${encodeURIComponent(query)}`);
            const data = await response.json();
            showResult(data);
        }

        async function searchTags() {
            const query = document.getElementById('tagQuery').value;
            if (!query) {
                showResult({ error: 'íƒœê·¸ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.' });
                return;
            }

            const response = await fetch(`${API_BASE}/search/tags?q=${encodeURIComponent(query)}`);
            const data = await response.json();
            showResult(data);
        }

        async function runPageTests() {
            const response = await fetch('/api/test/run/3', { method: 'POST' });
            const data = await response.json();
            showResult(data);
            loadTestCases();
        }

        async function loadTestCases() {
            const response = await fetch('/api/test/cases?pageNumber=3');
            const cases = await response.json();
            
            const statusResponse = await fetch('/api/test/page/3');
            const status = await statusResponse.json();
            
            const html = cases.map(tc => {
                const result = status.testResults.find(r => r.testId === tc.testId);
                const statusClass = result ? (result.passed ? 'text-success' : 'text-danger') : 'text-secondary';
                const statusIcon = result ? (result.passed ? 'âœ…' : 'âŒ') : 'â³';
                return `<div class="mb-2 ${statusClass}"><small>${statusIcon} ${tc.testId}: ${tc.testName}</small></div>`;
            }).join('');
            
            document.getElementById('testCases').innerHTML = html;
        }

        document.addEventListener('DOMContentLoaded', loadTestCases);
    </script>
</body>
</html>
