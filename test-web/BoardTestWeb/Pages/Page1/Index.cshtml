@page "/page1"
@model BoardTestWeb.Pages.Page1.IndexModel
@{
    ViewData["Title"] = "í˜ì´ì§€ 1: ê²Œì‹œë¬¼ ê´€ë¦¬ í…ŒìŠ¤íŠ¸";
}

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"]</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/">ğŸ“‹ ê²Œì‹œíŒ ë¼ì´ë¸ŒëŸ¬ë¦¬ í…ŒìŠ¤íŠ¸</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/">ëŒ€ì‹œë³´ë“œ</a>
                <a class="nav-link active" href="/page1">í˜ì´ì§€ 1</a>
                <a class="nav-link" href="/page2">í˜ì´ì§€ 2</a>
                <a class="nav-link" href="/page3">í˜ì´ì§€ 3</a>
                <a class="nav-link" href="/page4">í˜ì´ì§€ 4</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <h1>ğŸ“ í˜ì´ì§€ 1: ê²Œì‹œë¬¼ ê´€ë¦¬ í…ŒìŠ¤íŠ¸</h1>
        <p class="lead">ê²Œì‹œë¬¼ CRUD, ì¡°íšŒìˆ˜ ê´€ë¦¬, ìƒë‹¨ê³ ì •, ì„ì‹œì €ì¥ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>

        <div class="row">
            <!-- í…ŒìŠ¤íŠ¸ ì‹¤í–‰ íŒ¨ë„ -->
            <div class="col-md-4">
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-primary w-100 mb-3" onclick="runPageTests()">
                            â–¶ ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
                        </button>
                        <div id="testCases">
                            <!-- í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ëª©ë¡ -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- API í…ŒìŠ¤íŠ¸ íŒ¨ë„ -->
            <div class="col-md-8">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">API í…ŒìŠ¤íŠ¸</h5>
                    </div>
                    <div class="card-body">
                        <ul class="nav nav-tabs" id="apiTabs" role="tablist">
                            <li class="nav-item">
                                <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#createPost">ì‘ì„±</button>
                            </li>
                            <li class="nav-item">
                                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#listPosts">ëª©ë¡</button>
                            </li>
                            <li class="nav-item">
                                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#viewPost">ì¡°íšŒ</button>
                            </li>
                            <li class="nav-item">
                                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#pinPost">ìƒë‹¨ê³ ì •</button>
                            </li>
                            <li class="nav-item">
                                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#draftPost">ì„ì‹œì €ì¥</button>
                            </li>
                        </ul>
                        <div class="tab-content p-3 border border-top-0">
                            <!-- ê²Œì‹œë¬¼ ì‘ì„± -->
                            <div class="tab-pane fade show active" id="createPost">
                                <h6>ê²Œì‹œë¬¼ ì‘ì„±</h6>
                                <div class="mb-3">
                                    <label class="form-label">ì œëª©</label>
                                    <input type="text" class="form-control" id="postTitle" placeholder="ê²Œì‹œë¬¼ ì œëª©">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">ë‚´ìš©</label>
                                    <textarea class="form-control" id="postContent" rows="3" placeholder="ê²Œì‹œë¬¼ ë‚´ìš©"></textarea>
                                </div>
                                <button class="btn btn-primary" onclick="createPost()">ì‘ì„±í•˜ê¸°</button>
                            </div>

                            <!-- ê²Œì‹œë¬¼ ëª©ë¡ -->
                            <div class="tab-pane fade" id="listPosts">
                                <h6>ê²Œì‹œë¬¼ ëª©ë¡ ì¡°íšŒ</h6>
                                <div class="row mb-3">
                                    <div class="col">
                                        <label class="form-label">í˜ì´ì§€</label>
                                        <input type="number" class="form-control" id="listPage" value="1" min="1">
                                    </div>
                                    <div class="col">
                                        <label class="form-label">í˜ì´ì§€ í¬ê¸°</label>
                                        <input type="number" class="form-control" id="listPageSize" value="10" min="1" max="100">
                                    </div>
                                </div>
                                <button class="btn btn-primary" onclick="listPosts()">ì¡°íšŒí•˜ê¸°</button>
                            </div>

                            <!-- ê²Œì‹œë¬¼ ì¡°íšŒ -->
                            <div class="tab-pane fade" id="viewPost">
                                <h6>ê²Œì‹œë¬¼ ìƒì„¸ ì¡°íšŒ</h6>
                                <div class="mb-3">
                                    <label class="form-label">ê²Œì‹œë¬¼ ID</label>
                                    <input type="number" class="form-control" id="viewPostId" value="1" min="1">
                                </div>
                                <button class="btn btn-primary" onclick="viewPost()">ì¡°íšŒí•˜ê¸°</button>
                            </div>

                            <!-- ìƒë‹¨ê³ ì • -->
                            <div class="tab-pane fade" id="pinPost">
                                <h6>ìƒë‹¨ê³ ì • ì„¤ì •/í•´ì œ</h6>
                                <div class="mb-3">
                                    <label class="form-label">ê²Œì‹œë¬¼ ID</label>
                                    <input type="number" class="form-control" id="pinPostId" value="1" min="1">
                                </div>
                                <button class="btn btn-success me-2" onclick="pinPost()">ìƒë‹¨ê³ ì •</button>
                                <button class="btn btn-secondary" onclick="unpinPost()">ê³ ì •í•´ì œ</button>
                            </div>

                            <!-- ì„ì‹œì €ì¥ -->
                            <div class="tab-pane fade" id="draftPost">
                                <h6>ì„ì‹œì €ì¥</h6>
                                <div class="mb-3">
                                    <label class="form-label">ì œëª©</label>
                                    <input type="text" class="form-control" id="draftTitle" placeholder="ì„ì‹œì €ì¥ ì œëª©">
                                </div>
                                <button class="btn btn-warning me-2" onclick="saveDraft()">ì„ì‹œì €ì¥</button>
                                <button class="btn btn-outline-primary" onclick="loadDrafts()">ëª©ë¡ë³´ê¸°</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ê²°ê³¼ í‘œì‹œ -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">ê²°ê³¼</h5>
                    </div>
                    <div class="card-body">
                        <pre id="apiResult" class="bg-light p-3" style="max-height: 400px; overflow-y: auto;">ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_BASE = '/api/page1';

        function showResult(data) {
            document.getElementById('apiResult').textContent = JSON.stringify(data, null, 2);
        }

        async function createPost() {
            const title = document.getElementById('postTitle').value;
            const content = document.getElementById('postContent').value;
            
            const response = await fetch(`${API_BASE}/posts`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ title, content })
            });
            const data = await response.json();
            showResult(data);
        }

        async function listPosts() {
            const page = document.getElementById('listPage').value;
            const pageSize = document.getElementById('listPageSize').value;
            
            const response = await fetch(`${API_BASE}/posts?page=${page}&pageSize=${pageSize}`);
            const data = await response.json();
            showResult(data);
        }

        async function viewPost() {
            const id = document.getElementById('viewPostId').value;
            
            const response = await fetch(`${API_BASE}/posts/${id}`);
            const data = await response.json();
            showResult(data);
        }

        async function pinPost() {
            const id = document.getElementById('pinPostId').value;
            
            const response = await fetch(`${API_BASE}/posts/${id}/pin`, { method: 'POST' });
            const data = await response.json();
            showResult(data);
        }

        async function unpinPost() {
            const id = document.getElementById('pinPostId').value;
            
            const response = await fetch(`${API_BASE}/posts/${id}/pin`, { method: 'DELETE' });
            const data = await response.json();
            showResult(data);
        }

        async function saveDraft() {
            const title = document.getElementById('draftTitle').value;
            
            const response = await fetch(`${API_BASE}/posts/draft`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ title, content: 'ì„ì‹œì €ì¥ ë‚´ìš©' })
            });
            const data = await response.json();
            showResult(data);
        }

        async function loadDrafts() {
            const response = await fetch(`${API_BASE}/posts/draft`);
            const data = await response.json();
            showResult(data);
        }

        async function runPageTests() {
            const response = await fetch('/api/test/run/1', { method: 'POST' });
            const data = await response.json();
            showResult(data);
            loadTestCases();
        }

        async function loadTestCases() {
            const response = await fetch('/api/test/cases?pageNumber=1');
            const cases = await response.json();
            
            const statusResponse = await fetch('/api/test/page/1');
            const status = await statusResponse.json();
            
            const html = cases.map(tc => {
                const result = status.testResults.find(r => r.testId === tc.testId);
                const statusClass = result ? (result.passed ? 'text-success' : 'text-danger') : 'text-secondary';
                const statusIcon = result ? (result.passed ? 'âœ…' : 'âŒ') : 'â³';
                return `<div class="mb-2 ${statusClass}"><small>${statusIcon} ${tc.testId}: ${tc.testName}</small></div>`;
            }).join('');
            
            document.getElementById('testCases').innerHTML = html;
        }

        document.addEventListener('DOMContentLoaded', loadTestCases);
    </script>
</body>
</html>
